<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flappy Bird (Demo) — Jarvis-Da-Vinci</title>
  <style>
    :root{
      --bg:#70c5ce;
      --ground:#ded895;
      --pipe:#2ea44f;
      --text:#0b0b0b;
    }
    html,body{
      height:100%;
      margin:0;
      font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;
      background: linear-gradient(#87CEEB,#70c5ce 60%);
      display:flex;
      align-items:center;
      justify-content:center;
    }
    #gameWrap{
      width: 360px; /* klassische Flappy-Bird-Breite */
      max-width: 95vw;
      box-shadow: 0 8px 24px rgba(0,0,0,0.25);
      border-radius: 8px;
      overflow: hidden;
      background: linear-gradient(#70c5ce 0%, #9de0e9 100%);
      position: relative;
    }
    canvas{ display:block; width:100%; height:auto; background: transparent; }
    #hud {
      position:absolute; left:10px; top:10px; color:var(--text);
      background: rgba(255,255,255,0.85); padding:6px 10px; border-radius:6px;
      font-weight:600; user-select:none;
    }
    #msg {
      position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
      text-align:center;color:#fff;text-shadow:0 2px 6px rgba(0,0,0,0.5);
    }
    #msg .title { font-size:20px; margin-bottom:8px; font-weight:700; }
    #msg .sub { font-size:14px; opacity:0.95; }
    #controls { margin-top:8px; display:flex; gap:8px; justify-content:center; }
    .btn { background:#fff;padding:8px 12px;border-radius:6px;cursor:pointer;font-weight:700;}
    .small { font-size:12px; padding:6px 10px;}
    footer.note { font-size:11px; color:#333; padding:8px; text-align:center; background:rgba(255,255,255,0.85);}
  </style>
</head>
<body>
  <div id="gameWrap">
    <canvas id="game"></canvas>
    <div id="hud">Score: <span id="score">0</span></div>

    <div id="msg" style="display:none;">
      <div class="title">Flappy Bird — Demo</div>
      <div class="sub">Leertaste oder Klick zum Fliegen</div>
      <div id="controls">
        <div class="btn" id="startBtn">Start</div>
        <div class="btn small" id="muteBtn">Ton aus</div>
      </div>
    </div>
  </div>

  <script>
  // ---- Einstellungen ----
  const CANVAS_WIDTH = 480;     // interne Auflösung (skaliert im CSS)
  const CANVAS_HEIGHT = 640;
  const PIPE_WIDTH = 70;
  const PIPE_GAP = 160;        // Lücke zwischen oberen und unteren Rohr
  const PIPE_INTERVAL = 1500;  // ms zwischen neuen Rohren
  const GRAVITY = 0.0016;      // px/ms^2 ~ Schwerkraft
  const FLAP_VELOCITY = -0.45; // px/ms Impuls bei Flap
  const PIPE_SPEED = -0.18;    // px/ms Rohre bewegen sich nach links

  // ---- Setup Canvas & Skalierung ----
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d', { alpha: true });

  function resizeCanvas(){
    const wrap = document.getElementById('gameWrap');
    const rect = wrap.getBoundingClientRect();
    // interne Auflösung beibehalten, Canvas scaled via CSS
    canvas.width = CANVAS_WIDTH;
    canvas.height = CANVAS_HEIGHT;
    canvas.style.width = rect.width + 'px';
    canvas.style.height = (rect.width * CANVAS_HEIGHT / CANVAS_WIDTH) + 'px';
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  // ---- Assets ----
  const birdImg = new Image();
  birdImg.src = 'bird.jpg'; // <-- Leg deine bird.jpg ins gleiche Verzeichnis
  // Optional: pipe image? We'll draw pipes as rectangles by default.

  // ---- Game State ----
  let lastTime = 0;
  let running = false;
  let gameOver = false;
  let score = 0;
  let pipes = []; // {x, topHeight, passed}
  let spawnTimer = 0;

  // Bird physics
  const bird = {
    x: CANVAS_WIDTH * 0.25,
    y: CANVAS_HEIGHT * 0.4,
    vy: 0,
    rotation: 0,
    width: 48,
    height: 36,
  };

  // Ground (visual)
  const groundHeight = 80;

  // Audio (optional simple)
  let soundOn = false;
  const flapAudio = new Audio(); flapAudio.src = ''; // placeholder, disabled by default

  // ---- Controls ----
  function flap(){
    if (!running){
      startGame();
      return;
    }
    if (gameOver) return;
    bird.vy = FLAP_VELOCITY;
    bird.rotation = -0.35;
    if(soundOn) playFlap();
  }
  function playFlap(){ try{ flapAudio.currentTime=0; flapAudio.play(); }catch(e){} }

  window.addEventListener('keydown', e => {
    if (e.code === 'Space') { e.preventDefault(); flap(); }
  });
  window.addEventListener('mousedown', e => { flap(); });
  window.addEventListener('touchstart', e => { e.preventDefault(); flap(); }, {passive:false});

  document.getElementById('startBtn').addEventListener('click', startGame);
  const muteBtn = document.getElementById('muteBtn');
  muteBtn.addEventListener('click', () => {
    soundOn = !soundOn;
    muteBtn.innerText = soundOn ? 'Ton an' : 'Ton aus';
  });

  // ---- Game lifecycle ----
  function resetGame(){
    pipes = [];
    spawnTimer = 0;
    score = 0;
    bird.y = CANVAS_HEIGHT * 0.4;
    bird.vy = 0;
    bird.rotation = 0;
    gameOver = false;
    updateHUD();
  }

  function startGame(){
    resetGame();
    running = true;
    lastTime = performance.now();
    document.getElementById('msg').style.display = 'none';
    requestAnimationFrame(loop);
  }

  function endGame(){
    gameOver = true;
    running = false;
    document.getElementById('msg').style.display = 'block';
    document.querySelector('#msg .title').innerText = 'Game Over';
    document.querySelector('#msg .sub').innerText = 'Score: ' + score + ' — Klick Start um neu zu starten';
    document.getElementById('startBtn').innerText = 'Neustart';
  }

  // ---- Pipes creation ----
  function spawnPipe(){
    const minTop = 60;
    const maxTop = CANVAS_HEIGHT - groundHeight - PIPE_GAP - 60;
    const top = Math.floor(Math.random() * (maxTop - minTop + 1)) + minTop;
    pipes.push({ x: CANVAS_WIDTH + PIPE_WIDTH, topHeight: top, passed:false });
  }

  // ---- Collision detection ----
  function rectsOverlap(ax,ay,aw,ah, bx,by,bw,bh){
    return ax < bx + bw && ax + aw > bx && ay < by + bh && ay + ah > by;
  }

  function checkCollisions(){
    // ground collision
    if (bird.y + bird.height/2 >= CANVAS_HEIGHT - groundHeight){
      return true;
    }
    // ceiling
    if (bird.y - bird.height/2 <= 0) return true;

    // pipes
    for(const p of pipes){
      // top pipe rectangle
      if (rectsOverlap(bird.x - bird.width/2, bird.y - bird.height/2, bird.width, bird.height,
        p.x, 0, PIPE_WIDTH, p.topHeight)) return true;
      // bottom pipe
      const bottomY = p.topHeight + PIPE_GAP;
      if (rectsOverlap(bird.x - bird.width/2, bird.y - bird.height/2, bird.width, bird.height,
        p.x, bottomY, PIPE_WIDTH, CANVAS_HEIGHT - groundHeight - bottomY)) return true;
    }
    return false;
  }

  // ---- HUD ----
  function updateHUD(){ document.getElementById('score').innerText = score; }

  // ---- Main Loop ----
  function loop(now){
    const dt = now - lastTime;
    lastTime = now;

    // physics
    bird.vy += GRAVITY * dt;
    bird.y += bird.vy * dt;
    bird.rotation += 0.001 * dt;
    if (bird.rotation > 1.2) bird.rotation = 1.2;

    // spawn pipes
    spawnTimer += dt;
    if (spawnTimer >= PIPE_INTERVAL){
      spawnTimer = 0;
      spawnPipe();
    }

    // move pipes
    for(const p of pipes){
      p.x += PIPE_SPEED * dt;
      // scoring
      if (!p.passed && p.x + PIPE_WIDTH < bird.x - bird.width/2){
        p.passed = true;
        score += 1;
        updateHUD();
      }
    }
    // remove off-screen pipes
    pipes = pipes.filter(p => p.x + PIPE_WIDTH > -50);

    // check collision
    if (!gameOver && checkCollisions()){
      endGame();
    }

    // draw
    draw();

    if (running) requestAnimationFrame(loop);
  }

  // ---- Drawing ----
  function draw(){
    // clear
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // background gradient (sky)
    const g = ctx.createLinearGradient(0,0,0,canvas.height);
    g.addColorStop(0,'#87CEEB'); g.addColorStop(1,'#9de0e9');
    ctx.fillStyle = g; ctx.fillRect(0,0,canvas.width,canvas.height);

    // pipes
    ctx.fillStyle = '#2ea44f';
    for(const p of pipes){
      // top
      ctx.fillRect(p.x, 0, PIPE_WIDTH, p.topHeight);
      // cap (rounded top) - simple shadow
      ctx.fillStyle = 'rgba(0,0,0,0.06)';
      ctx.fillRect(p.x, p.topHeight - 8, PIPE_WIDTH, 8);
      ctx.fillStyle = '#2ea44f';
      // bottom
      const bottomY = p.topHeight + PIPE_GAP;
      ctx.fillRect(p.x, bottomY, PIPE_WIDTH, canvas.height - groundHeight - bottomY);
      ctx.fillStyle = 'rgba(0,0,0,0.06)';
      ctx.fillRect(p.x, bottomY + (canvas.height - groundHeight - bottomY) - 8, PIPE_WIDTH, 8);
      ctx.fillStyle = '#2ea44f';
    }

    // ground
    ctx.fillStyle = '#ded895';
    ctx.fillRect(0, canvas.height - groundHeight, canvas.width, groundHeight);

    // bird (image) centered on bird.x/bird.y
    const bw = bird.width;
    const bh = bird.height;
    ctx.save();
    ctx.translate(bird.x, bird.y);
    ctx.rotate(bird.rotation);
    if (birdImg.complete && birdImg.naturalWidth !== 0){
      // draw image with center alignment
      ctx.drawImage(birdImg, -bw/2, -bh/2, bw, bh);
    } else {
      // placeholder circle if image not loaded
      ctx.fillStyle = '#FFDD57';
      ctx.beginPath(); ctx.ellipse(0,0,bw/2,bh/2,0,0,Math.PI*2); ctx.fill();
    }
    ctx.restore();

    // score big (center top)
    ctx.fillStyle = 'rgba(0,0,0,0.6)';
    ctx.font = 'bold 36px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(score, canvas.width/2, 56);
  }

  // ---- On load: show message and wire up image load ----
  birdImg.onload = () => {
    // scale bird to reasonable size depending on canvas
    const scale = Math.min(1, canvas.width / 480);
    bird.width = Math.round(48 * scale * 1.5);
    bird.height = Math.round(36 * scale * 1.5);
    draw();
  };

  // show initial message
  document.getElementById('msg').style.display = 'block';
  document.querySelector('#msg .title').innerText = 'Flappy Bird Demo';
  document.querySelector('#msg .sub').innerText = 'Leertaste oder Klick zum Fliegen';

  // initial draw
  draw();

  // center on load resize
  setTimeout(resizeCanvas, 100);
  </script>
</body>
</html>
