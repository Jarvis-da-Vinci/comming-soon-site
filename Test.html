<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flappy Bird (Demo) — Jarvis-Da-Vinci</title>
  <style>
    html,body{
      height:100%;
      margin:0;
      font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;
      background: linear-gradient(#87CEEB,#70c5ce 60%);
      display:flex;
      align-items:center;
      justify-content:center;
    }
    #gameWrap{
      width: 360px;
      max-width: 95vw;
      box-shadow: 0 8px 24px rgba(0,0,0,0.25);
      border-radius: 8px;
      overflow: hidden;
      background: linear-gradient(#70c5ce 0%, #9de0e9 100%);
      position: relative;
    }
    canvas{ display:block; width:100%; height:auto; background: transparent; }
    #hud {
      position:absolute; left:10px; top:10px; color:#0b0b0b;
      background: rgba(255,255,255,0.85); padding:6px 10px; border-radius:6px;
      font-weight:600; user-select:none;
    }
    #msg {
      position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
      text-align:center;color:#fff;text-shadow:0 2px 6px rgba(0,0,0,0.5);
    }
    #msg .title { font-size:20px; margin-bottom:8px; font-weight:700; }
    #msg .sub { font-size:14px; opacity:0.95; }
    #controls { margin-top:8px; display:flex; gap:8px; justify-content:center; }
    .btn { background:#fff;padding:8px 12px;border-radius:6px;cursor:pointer;font-weight:700;}
    .small { font-size:12px; padding:6px 10px;}
  </style>
</head>
<body>
  <div id="gameWrap">
    <canvas id="game"></canvas>
    <div id="hud">Score: <span id="score">0</span></div>

    <div id="msg" style="display:none;">
      <div class="title">Flappy Bird — Demo</div>
      <div class="sub">Leertaste oder Klick zum Fliegen</div>
      <div id="controls">
        <div class="btn" id="startBtn">Start</div>
        <div class="btn small" id="muteBtn">Ton aus</div>
      </div>
    </div>
  </div>

  <script>
  // ---- Einstellungen ----
  const CANVAS_WIDTH = 480;
  const CANVAS_HEIGHT = 640;
  const PIPE_WIDTH = 70;
  const PIPE_GAP = 160;
  const PIPE_INTERVAL = 1500;
  const GRAVITY = 0.0016;
  const FLAP_VELOCITY = -0.45;
  const PIPE_SPEED = -0.18;

  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');

  function resizeCanvas(){
    const wrap = document.getElementById('gameWrap');
    const rect = wrap.getBoundingClientRect();
    canvas.width = CANVAS_WIDTH;
    canvas.height = CANVAS_HEIGHT;
    canvas.style.width = rect.width + 'px';
    canvas.style.height = (rect.width * CANVAS_HEIGHT / CANVAS_WIDTH) + 'px';
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  // ---- Assets ----
  const birdImg = new Image();
  birdImg.src = 'bird.jpg'; // Dein Bird-Bild
  const serverImg = new Image();
  serverImg.src = "server.jpg"; // Dein Server-Bild für Pipes

  // ---- Game State ----
  let lastTime = 0;
  let running = false;
  let gameOver = false;
  let score = 0;
  let pipes = [];
  let spawnTimer = 0;

  const bird = {
    x: CANVAS_WIDTH * 0.25,
    y: CANVAS_HEIGHT * 0.4,
    vy: 0,
    rotation: 0,
    width: 48,
    height: 36,
  };

  const groundHeight = 80;
  let soundOn = false;

  function flap(){
    if (!running){
      startGame();
      return;
    }
    if (gameOver) return;
    bird.vy = FLAP_VELOCITY;
    bird.rotation = -0.35;
  }

  window.addEventListener('keydown', e => { if (e.code === 'Space'){ e.preventDefault(); flap(); } });
  window.addEventListener('mousedown', e => { flap(); });
  window.addEventListener('touchstart', e => { e.preventDefault(); flap(); }, {passive:false});

  document.getElementById('startBtn').addEventListener('click', startGame);
  const muteBtn = document.getElementById('muteBtn');
  muteBtn.addEventListener('click', () => {
    soundOn = !soundOn;
    muteBtn.innerText = soundOn ? 'Ton an' : 'Ton aus';
  });

  function resetGame(){
    pipes = [];
    spawnTimer = 0;
    score = 0;
    bird.y = CANVAS_HEIGHT * 0.4;
    bird.vy = 0;
    bird.rotation = 0;
    gameOver = false;
    updateHUD();
  }

  function startGame(){
    resetGame();
    running = true;
    lastTime = performance.now();
    document.getElementById('msg').style.display = 'none';
    requestAnimationFrame(loop);
  }

  function endGame(){
    gameOver = true;
    running = false;
    document.getElementById('msg').style.display = 'block';
    document.querySelector('#msg .title').innerText = 'Game Over';
    document.querySelector('#msg .sub').innerText = 'Score: ' + score + ' — Klick Start um neu zu starten';
    document.getElementById('startBtn').innerText = 'Neustart';
  }

  function spawnPipe(){
    const minTop = 60;
    const maxTop = CANVAS_HEIGHT - groundHeight - PIPE_GAP - 60;
    const top = Math.floor(Math.random() * (maxTop - minTop + 1)) + minTop;
    pipes.push({ x: CANVAS_WIDTH + PIPE_WIDTH, topHeight: top, passed:false });
  }

  function rectsOverlap(ax,ay,aw,ah, bx,by,bw,bh){
    return ax < bx + bw && ax + aw > bx && ay < by + bh && ay + ah > by;
  }

  function checkCollisions(){
    if (bird.y + bird.height/2 >= CANVAS_HEIGHT - groundHeight){ return true; }
    if (bird.y - bird.height/2 <= 0) return true;
    for(const p of pipes){
      if (rectsOverlap(bird.x - bird.width/2, bird.y - bird.height/2, bird.width, bird.height,
        p.x, 0, PIPE_WIDTH, p.topHeight)) return true;
      const bottomY = p.topHeight + PIPE_GAP;
      if (rectsOverlap(bird.x - bird.width/2, bird.y - bird.height/2, bird.width, bird.height,
        p.x, bottomY, PIPE_WIDTH, CANVAS_HEIGHT - groundHeight - bottomY)) return true;
    }
    return false;
  }

  function updateHUD(){ document.getElementById('score').innerText = score; }

  function loop(now){
    const dt = now - lastTime;
    lastTime = now;

    bird.vy += GRAVITY * dt;
    bird.y += bird.vy * dt;
    bird.rotation += 0.001 * dt;
    if (bird.rotation > 1.2) bird.rotation = 1.2;

    spawnTimer += dt;
    if (spawnTimer >= PIPE_INTERVAL){
      spawnTimer = 0;
      spawnPipe();
    }

    for(const p of pipes){
      p.x += PIPE_SPEED * dt;
      if (!p.passed && p.x + PIPE_WIDTH < bird.x - bird.width/2){
        p.passed = true;
        score += 1;
        updateHUD();
      }
    }
    pipes = pipes.filter(p => p.x + PIPE_WIDTH > -50);

    if (!gameOver && checkCollisions()){ endGame(); }
    draw();
    if (running) requestAnimationFrame(loop);
  }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Hintergrund
    const g = ctx.createLinearGradient(0,0,0,canvas.height);
    g.addColorStop(0,'#87CEEB'); g.addColorStop(1,'#9de0e9');
    ctx.fillStyle = g; ctx.fillRect(0,0,canvas.width,canvas.height);

    // Pipes als Server-Bilder
    for(const p of pipes){
      const bottomY = p.topHeight + PIPE_GAP;
      ctx.drawImage(serverImg, p.x, 0, PIPE_WIDTH, p.topHeight);
      ctx.drawImage(serverImg, p.x, bottomY, PIPE_WIDTH, canvas.height - groundHeight - bottomY);
    }

    // Boden
    ctx.fillStyle = '#ded895';
    ctx.fillRect(0, canvas.height - groundHeight, canvas.width, groundHeight);

    // Bird (rund)
    const bw = bird.width, bh = bird.height;
    ctx.save();
    ctx.translate(bird.x, bird.y);
    ctx.rotate(bird.rotation);
    if (birdImg.complete && birdImg.naturalWidth !== 0){
      ctx.beginPath();
      ctx.arc(0, 0, bw/2, 0, Math.PI * 2);
      ctx.closePath();
      ctx.clip();
      ctx.drawImage(birdImg, -bw/2, -bh/2, bw, bh);
    } else {
      ctx.fillStyle = '#FFDD57';
      ctx.beginPath();
      ctx.arc(0,0,bw/2,0,Math.PI*2);
      ctx.fill();
    }
    ctx.restore();

    // Score
    ctx.fillStyle = 'rgba(0,0,0,0.6)';
    ctx.font = 'bold 36px Arial';
    ctx.textAlign = 'center';
    ctx.fillText(score, canvas.width/2, 56);
  }

  birdImg.onload = () => {
    const scale = Math.min(1, canvas.width / 480);
    bird.width = Math.round(48 * scale * 1.5);
    bird.height = Math.round(36 * scale * 1.5);
    draw();
  };

  document.getElementById('msg').style.display = 'block';
  document.querySelector('#msg .title').innerText = 'Flappy Bird Demo';
  document.querySelector('#msg .sub').innerText = 'Leertaste oder Klick zum Fliegen';
  draw();
  setTimeout(resizeCanvas, 100);
  </script>
</body>
</html>
