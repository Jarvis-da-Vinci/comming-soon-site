<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Umfrage</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: Arial, sans-serif; height:100vh; display:flex; flex-direction:column; }
    
    /* Container f√ºr Umfrage */
    #umfrage { flex:1; display:flex; flex-direction:column; }
    .smileys { flex:1; display:flex; }
    .smiley {
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:80px;
      cursor:pointer;
      position:relative;
      color:white;
    }
    .gut { background:green; }
    .mittel { background:goldenrod; }
    .schlecht { background:crimson; }
    button {
      padding:15px;
      font-size:20px;
      border:none;
      cursor:pointer;
      background:#0077cc;
      color:white;
      width:100%;
    }

    /* Wellen-Animation */
    .wave {
      position: absolute;
      top: 50%; left: 50%;
      width: 30px; height: 30px;
      border-radius: 50%;
      background: rgba(255,255,255,0.6);
      transform: translate(-50%, -50%) scale(0);
      animation: ripple 0.6s ease-out forwards;
      pointer-events: none;
    }
    @keyframes ripple {
      to {
        transform: translate(-50%, -50%) scale(10);
        opacity: 0;
      }
    }

    /* Ergebnisseite */
    #ergebnis { display:none; text-align:center; padding:20px; }
    #chart-container { width: 350px; margin: 20px auto; }
    .liste { max-width:400px; margin:20px auto; text-align:left; font-size:18px; }
    .gutText { color:green; font-weight:bold; }
    .mittelText { color:goldenrod; font-weight:bold; }
    .schlechtText { color:crimson; font-weight:bold; }
    .buttons { margin-top:20px; }
    .buttons button {
      margin:10px;
      width:auto;
      border-radius:12px;
    }
    .reset { background:#cc0000; }
    .back { background:#0077cc; }
  </style>
</head>
<body>

  <!-- Umfrage-Seite -->
  <div id="umfrage">
    <div class="smileys">
      <div class="smiley gut" onclick="vote('gut', this)">üòä</div>
      <div class="smiley mittel" onclick="vote('mittel', this)">üòê</div>
      <div class="smiley schlecht" onclick="vote('schlecht', this)">üòû</div>
    </div>
    <button onclick="showResults()">Ergebnisse anzeigen</button>
  </div>

  <!-- Ergebnisse-Seite -->
  <div id="ergebnis">
    <h1>Ergebnisse</h1>
    <div id="chart-container">
      <canvas id="resultsChart"></canvas>
    </div>
    <div class="liste" id="resultList"></div>
    <p id="totalVotes"></p>
    <div class="buttons">
      <button class="reset" onclick="resetVotes()">Reset</button>
      <button class="back" onclick="showUmfrage()">Zur√ºck zur Umfrage</button>
    </div>
  </div>

<script>
  let votes = JSON.parse(localStorage.getItem("umfrage")) || {gut:0, mittel:0, schlecht:0};
  let chart; // f√ºr Chart.js

  // Stimmen abgeben
  function vote(option, element) {
    votes[option]++;
    localStorage.setItem("umfrage", JSON.stringify(votes));

    // Wellen-Effekt erzeugen
    let wave = document.createElement("span");
    wave.classList.add("wave");
    element.appendChild(wave);
    setTimeout(() => wave.remove(), 600);
  }

  // Ergebnisse anzeigen
  function showResults() {
    document.getElementById("umfrage").style.display = "none";
    document.getElementById("ergebnis").style.display = "block";

    renderResults();
  }

  // Zur√ºck zur Umfrage
  function showUmfrage() {
    document.getElementById("ergebnis").style.display = "none";
    document.getElementById("umfrage").style.display = "flex";
  }

  // Ergebnisse aufbauen
  function renderResults() {
    const total = votes.gut + votes.mittel + votes.schlecht;

    // Chart aktualisieren
    const ctx = document.getElementById('resultsChart').getContext('2d');
    if (chart) chart.destroy(); // alten Chart l√∂schen
    chart = new Chart(ctx, {
      type: 'pie',
      data: {
        labels: ['Gut üòä', 'Mittel üòê', 'Schlecht üòû'],
        datasets: [{
          data: [votes.gut, votes.mittel, votes.schlecht],
          backgroundColor: ['green', 'goldenrod', 'crimson']
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { position: 'bottom' },
          tooltip: {
            callbacks: {
              label: function(tooltipItem) {
                let val = tooltipItem.raw;
                let percent = total ? ((val / total) * 100).toFixed(1) + "%" : "0%";
                return tooltipItem.label + ": " + val + " (" + percent + ")";
              }
            }
          }
        }
      }
    });

    // Liste erzeugen
    let html = `
      <div class="gutText">üòä Gut: ${votes.gut} Stimmen (${total ? ((votes.gut/total)*100).toFixed(1) : 0}%)</div>
      <div class="mittelText">üòê Mittel: ${votes.mittel} Stimmen (${total ? ((votes.mittel/total)*100).toFixed(1) : 0}%)</div>
      <div class="schlechtText">üòû Schlecht: ${votes.schlecht} Stimmen (${total ? ((votes.schlecht/total)*100).toFixed(1) : 0}%)</div>
    `;
    document.getElementById("resultList").innerHTML = html;
    document.getElementById("totalVotes").innerText = "Gesamt: " + total + " Stimmen";
  }

  // Reset
  function resetVotes() {
    localStorage.removeItem("umfrage");
    votes = {gut:0, mittel:0, schlecht:0};
    renderResults();
  }
</script>
</body>
</html>
      
